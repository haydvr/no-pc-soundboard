<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Loudboard</title>
<style>
body {
  background:#111;
  color:#fff;
  font-family:Arial, sans-serif;
  margin:0;
  padding:20px;
}
h1 { text-align:center; }
.controls { text-align:center; margin-bottom:10px; }
button {
  padding:6px 12px;
  margin:2px;
  background:#444;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
button:hover { background:#666; }
#dropzone {
  border:2px dashed #555;
  padding:20px;
  text-align:center;
  margin-bottom:15px;
}
.track {
  display:flex;
  align-items:center;
  gap:6px;
  margin-bottom:6px;
}
.track span {
  flex:1;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
input[type=range] { width:90px; }
#subscribe {
  margin-top:30px;
  font-size:40px;
  font-weight:bold;
  color:red;
  text-align:center;
  cursor:pointer;
}
#searchBar {
  width:90%;
  max-width:500px;
  padding:6px;
  margin-bottom:10px;
  border-radius:6px;
  border:1px solid #555;
  display:block;
  margin-left:auto;
  margin-right:auto;
}
.category-label {
  font-size:12px;
  background:#222;
  padding:2px 4px;
  border-radius:4px;
  margin-left:2px;
}
</style>
</head>
<body>

<h1>Loudboard</h1>

<div class="controls">
  <button id="addFiles">Add Files</button>
  <button id="addFolder">Add Folder</button>
  <button id="stopAll">Stop All</button>
  <button id="ownerBtn">Owner Stuff</button>
</div>

<div class="controls">
  Master Volume:
  <input id="master" type="range" min="100" max="1000" value="100">
  <span id="masterVal">100%</span>
</div>

<input type="text" id="searchBar" placeholder="Search tracks...">

<div id="dropzone">Drag & Drop MP3 / WAV files here</div>

<div id="tracks"></div>

<input id="fileInput" type="file" multiple accept="audio/*" hidden>
<input id="folderInput" type="file" webkitdirectory hidden>

<div id="subscribe"
onclick="window.open('https://www.youtube.com/@Haydenplaysvr1','_blank')">
SUBSCRIBE TO HAYDVR
</div>

<script>
/* ===== AUDIO CORE ===== */
const ctx = new (window.AudioContext || window.webkitAudioContext)();
const masterGain = ctx.createGain();
masterGain.connect(ctx.destination);
masterGain.gain.value = 1;

document.body.addEventListener("click", () => { if(ctx.state==="suspended") ctx.resume(); }, {once:true});

/* ===== OWNER MODE ===== */
const OWNER_PASS = "pokemon/admin132";
let owner = false;
let panic = false;
let savedGain = 1;

const master = document.getElementById("master");
const masterVal = document.getElementById("masterVal");

ownerBtn.onclick = () => {
  if (owner) return alert("Already unlocked");
  const p = prompt("Owner password:");
  if (p !== OWNER_PASS) return alert("Wrong password");
  owner = true;
  master.max = 40000;
  alert("Owner mode unlocked (40000%) â€” Loop & Categories unlocked");
};

/* ===== PANIC MUTE ===== */
document.addEventListener("keydown", e => {
  if (!owner) return;
  if (e.key.toLowerCase() !== "m") return;

  if (!panic) {
    savedGain = masterGain.gain.value;
    masterGain.gain.value = 0;
    masterVal.textContent = "MUTED (PANIC)";
    panic = true;
  } else {
    masterGain.gain.value = savedGain;
    panic = false;
    masterVal.textContent = master.value + "%";
  }
});

/* ===== MASTER VOLUME ===== */
master.oninput = () => {
  if (panic) return;
  masterGain.gain.value = master.value / 100;
  masterVal.textContent = master.value + "%";
};

/* ===== TRACK SYSTEM ===== */
const tracksDiv = document.getElementById("tracks");
const allSources = [];
const trackObjs = [];

function addTrack(file) {
  if (!file.type.startsWith("audio/")) return;

  const reader = new FileReader();
  reader.onload = async () => {
    const buffer = await ctx.decodeAudioData(reader.result);

    const track = {
      name:file.name,
      buffer,
      source:null,
      gain:ctx.createGain(),
      loop:false,
      category:"None"
    };
    track.gain.connect(masterGain);
    trackObjs.push(track);

    const div = document.createElement("div");
    div.className = "track";

    const label = document.createElement("span");
    label.textContent = file.name;

    const playBtn = document.createElement("button");
    playBtn.textContent="Play";

    const restartBtn = document.createElement("button");
    restartBtn.textContent="Restart";

    const muteBtn = document.createElement("button");
    muteBtn.textContent="Mute";

    const loopBtn = document.createElement("button");
    loopBtn.textContent="Loop";
    loopBtn.disabled = true; // Owner-only

    const catBtn = document.createElement("button");
    catBtn.textContent="Set Category";
    catBtn.disabled = true; // Owner-only

    const vol = document.createElement("input");
    vol.type="range";
    vol.min=0; vol.max=2; vol.step=0.01; vol.value=1;

    function play() {
      if(track.source) track.source.stop();
      track.source = ctx.createBufferSource();
      track.source.buffer = track.buffer;
      track.source.loop = track.loop;
      track.source.connect(track.gain);
      track.source.start();
      allSources.push(track.source);
    }

    playBtn.onclick = play;
    restartBtn.onclick = () => {
      if(track.source) track.source.stop();
      play();
    };
    muteBtn.onclick = () => {
      if(track.gain.gain.value>0) { track.gain.gain.value=0; muteBtn.textContent="Unmute"; }
      else { track.gain.gain.value=vol.value; muteBtn.textContent="Mute"; }
    };
    vol.oninput = ()=>{ if(track.gain.gain.value>0) track.gain.gain.value=vol.value; };

    loopBtn.onclick = ()=>{
      if(!owner) return alert("Owner-only");
      track.loop = !track.loop;
      loopBtn.textContent = track.loop ? "Looping" : "Loop";
      if(track.source) track.source.loop = track.loop;
    };

    catBtn.onclick = ()=>{
      if(!owner) return alert("Owner-only");
      const cat = prompt("Enter category name:", track.category);
      if(cat) { track.category=cat; label.innerHTML=file.name+' <span class="category-label">'+cat+'</span>'; }
    };

    div.append(label, playBtn, restartBtn, muteBtn, vol, loopBtn, catBtn);
    tracksDiv.appendChild(div);

    // Enable owner-only buttons if owner unlocked
    if(owner){
      loopBtn.disabled=false;
      catBtn.disabled=false;
    }
  };
  reader.readAsArrayBuffer(file);
}

/* ===== FILE INPUT ===== */
fileInput.onchange = e => [...e.target.files].forEach(addTrack);
folderInput.onchange = e => [...e.target.files].forEach(addTrack);

addFiles.onclick = () => fileInput.click();
addFolder.onclick = () => folderInput.click();

/* ===== DRAG & DROP ===== */
dropzone.ondragover = e => e.preventDefault();
dropzone.ondrop = e => {
  e.preventDefault();
  [...e.dataTransfer.files].forEach(addTrack);
};

/* ===== STOP ALL ===== */
stopAll.onclick = () => {
  allSources.forEach(s => { try{s.stop();}catch{} });
  allSources.length = 0;
};

/* ===== SEARCH BAR ===== */
searchBar.oninput = () => {
  const q = searchBar.value.toLowerCase();
  trackObjs.forEach((t,i)=>{
    const div = tracksDiv.children[i];
    div.style.display = t.name.toLowerCase().includes(q) || t.category.toLowerCase().includes(q) ? "" : "none";
  });
};
</script>
</body>
</html>
